String.prototype.hashCode=function(){var a=0,b,c;if(0===this.length)return a;b=0;for(l=this.length;b<l;b++)c=this.charCodeAt(b),a=(a<<5)-a+c,a|=0;return a};String.prototype.deres=function(){return this.replace(/img[^>]*>/g,"")};String.prototype.decamel=function(){return this.replace(/(?=[a-zA-z])(?=[A-Z])/g,"-").toLowerCase()};String.prototype.matchAny=function(a){var b=this,c=!1;$.each(a,function(a,e){if(b.match(e))return c=a,!1});return c};
Array.prototype.unique=function(){return this.reduce(function(a,b){0>a.indexOf(b)&&a.push(b);return a},[])};Array.prototype.diff=function(a){return this.reduce(function(b,c){-1==a.indexOf(c)&&b.push(c);return b},[])};function handle(a,b,c,d){a=$(a);a.off(b);a.on(b,c)}function getBlob(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(){var a=window.URL.createObjectURL(this.response);b(a)};c.send()}
function getDataUri(a,b,c){"undefined"==typeof c&&(c=b,b=!1);var d=new Image;d.onload=function(){var a=document.createElement("canvas");a.width=this.naturalWidth;a.height=this.naturalHeight;var d=a.getContext("2d");d.drawImage(this,0,0);if(b){var f=a.width/2,g=a.height/2,k=new Image;k.onload=function(){d.fillStyle="white";d.fillRect(f,g,f,g);d.drawImage(this,f,g,f,g);c(a.toDataURL("image/png"))};k.src=b}else c(a.toDataURL("image/png"))};d.src=a}
function localJSON(a,b){if("undefined"==typeof b){var c=localStorage[a];"undefined"!==typeof c&&(c=$.parseJSON(c));return c}""===b?delete localStorage[a]:localStorage[a]=JSON.stringify(b)}function showView(a,b,c){"undefined"==typeof c&&(c=170);0<c?($(a).fadeOut(c),$(b).delay(c).fadeIn(c)):($(a).hide(),$(b).show())}function _factory(a,b){return $(a+" "+b).clone()}crapi=new CrAPI;CrAPI.prototype.manifest=function(){return chrome.runtime.getManifest()};CrAPI.prototype.reload=function(){location.reload()};
CrAPI.prototype.debug=crapi.manifest().debug;CrAPI.prototype.lock=function(a){"undefined"==typeof a&&(a="");localStorage.crapi_locked=a};CrAPI.prototype.locked=function(){return localStorage.crapi_locked};
function CrAPI(){console.log("%cCrAPI%c :: Init","font-weight: bold; color: green","");this.DEFAULT_CALLBACK=function(a){return"undefined"!=typeof a?a:!1};this.badgeColors={gray:"#9a9a9a",red:"#d00"};this.badgeOptions={title:!1,color:!1,text:!1};"undefined"==typeof localStorage.crapi_locked&&(localStorage.crapi_locked="")}CrAPI.prototype.storage=function(a){switch("undefined"==typeof a?"sync":a){case "local":return chrome.storage.local;case "sync":return chrome.storage.sync;default:return!1}};
CrAPI.prototype.clone=function(a,b){"undefined"==typeof a&&(a=null,b=this.DEFAULT_CALLBACK);"undefined"==typeof b&&(b=a,a=null);this.storage().get(a,function(a){console.log("%cCrAPI%c :: Clone storage: %O","font-weight: bold; color: green","",a);b(a)})};
CrAPI.prototype.update=function(a,b,c){"undefined"==typeof c&&(c=this.DEFAULT_CALLBACK);var d=this;if(d.locked())console.error("%cCrAPI%c :: Storage locked: %o","font-weight: bold; color: green","",this.locked),c(!1);else{var e={};e[a]=b;d.lock("Update storage");d.storage().set(e,function(){d.lock();console.log("%cCrAPI%c :: Update storage: %O","font-weight: bold; color: green","",e);c(b)})}};
CrAPI.prototype.updateAll=function(a,b){"undefined"==typeof b&&(b=this.DEFAULT_CALLBACK);var c=this;c.locked()?(console.error("%cCrAPI%c :: Storage locked: %o","font-weight: bold; color: green","",this.locked),b(!1)):(c.lock("Update all"),c.storage().set(a,function(){c.lock();console.log("%cCrAPI%c :: Update all: %O","font-weight: bold; color: green","",a);b(!0)}))};
CrAPI.prototype.badge=function(a){a=$.extend({},this.badgeOptions,a);var b="undefined"!=typeof this.badgeColors[a.color]?this.badgeColors[a.color]:a.color;!1!==a.title&&chrome.browserAction.setTitle({title:a.title});!1!==b&&chrome.browserAction.setBadgeBackgroundColor({color:b});!1!==a.text&&chrome.browserAction.setBadgeText({text:a.text})};CrAPI.prototype.tests={};
CrAPI.prototype.runTests=function(){function a(a,b,c){return function(){a.apply(b,c)}}console.group("== CrAPI Tests ==");try{var b=[];$.each(this.tests,function(){b.push(this)});console.debug("queue: %o",b);var c=function(){console.debug("== End of Tests ==");console.groupEnd()};for(i=b.length-1;0<=i;i--)c=a(b[i],this,[c]);c()}catch(d){console.error(d),console.groupEnd()}};
CrAPI.prototype.tests.storageTest1=function(a){console.groupCollapsed("Test Chrome storage functions");try{var b=this;console.log("storageTest this: %o",this);var c=["test1","test2"],d={test1:"root set",test2:{initial:"data"}},e={test2:{secondary:"data"}};console.debug("Clearing test storage...");b.storage().remove(c,function(){b.storage().get(c,function(f){console.debug("Blank storage: %s",JSON.stringify(f));console.debug("Setting testData1: %o",d);b.storage().set(d,function(){b.storage().get(c,
function(d){console.debug("Result: %s",JSON.stringify(d));console.debug("Setting testData2: %o",e);b.storage().set($.extend(!0,{},d,e),function(){b.storage().get(c,function(b){console.debug("Result: %s",JSON.stringify(b));console.groupEnd();a()})})})})})})}catch(h){console.error(h),console.groupEnd()}};
CrAPI.prototype.tests.storageTest2=function(a){console.groupCollapsed("Test CrAPI storage functions");try{var b=this,c=["test1","test2"],d={test1:"root set",test2:{initial:"data"}},e={test2:{secondary:"data"}};console.debug("Clearing test storage...");b.storage().remove(c,function(){b.clone(c,function(f){console.debug("Blank storage: %s",JSON.stringify(f));console.debug("Setting testData1: %o",d);b.updateAll(d,function(){b.clone(c,function(d){console.debug("Result: %s",JSON.stringify(d));console.debug("Setting testData2: %o",
e);b.updateAll($.extend(!0,{},d,e),function(){b.clone(c,function(b){console.debug("Result: %s",JSON.stringify(b));console.groupEnd();a()})})})})})})}catch(h){console.error(h),console.groupEnd()}};modapi=new ModAPI;modapi.manifest=crapi.manifest();
var protocol="https://",domain="soundation.com",global={debug:modapi.manifest.debug,path:{protocol:protocol,domain:domain,home:protocol+domain,cookie:protocol+domain,login:protocol+domain+"?login=yes",feed:protocol+domain+"/feed",api:protocol+"api."+domain+"/me",profile:protocol+domain+"/account/profile",messages:protocol+domain+"/account/messages"},cookie:"_soundation_session",storageModel:{options:{},watchlist:[],version:""},optionDefaults:{rememberMe:!1,showAlertsOnTop:!1,watchlist:!1,userTags:!0,
userTagLinks:!1,moveCommentBox:!0,groupFilters:!0,moveGroupInvites:!0},regex:{messageLink:/\/account\/messages\/\d+$/,groupLink:/\/group\//,trackLink:/\/user\/.*\/track\//},watchlistModel:{track:{link:"",likes:0,downloads:0,comments:0},group:{link:"",lastComment:"",members:0,followers:0,tracks:0}}};function ModAPI(){console.log("%cModAPI%c :: Init","font-weight: bold; color: #f60","");this.DEFAULT_CALLBACK=function(){}}
ModAPI.prototype.login=function(a){function b(a){$.getJSON(global.path.api).fail(function(){console.error("%cModAPI%c :: Unable to connect to Soundation API","font-weight: bold; color: #f60","")}).success(function(b){var e=b.data||b;e.success=b.success;a(e)})}"undefined"==typeof a&&(a=this.DEFAULT_CALLBACK);console.log("%cModAPI%c :: Login","font-weight: bold; color: #f60","");$.get(global.path.home,function(c){c=c.deres();c=$(c);var d=c.find(".user-link").attr("href"),e=c.filter("[name=csrf-token]").attr("content");
b(function(b){b.link=d;global.token=e;a(b)})})};ModAPI.prototype.token=function(){return global.token};
